<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emerald | Order Food</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Inter', sans-serif; background:#000; color: white; }
  .menu-category { display: none; }
  .menu-category.active { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 1rem; }
  .locked { opacity: 0.5; pointer-events: none; }
</style>
</head>
<body class="p-4 pb-48">
  <h1 class="text-4xl font-bold text-center text-yellow-500 mb-6">Emerald</h1>
  
  <div class="max-w-md mx-auto space-y-4 mb-8">
    <input id="custName" placeholder="Enter Your Name" class="w-full p-4 rounded-xl text-black font-bold outline-none focus:ring-2 focus:ring-yellow-500">
    
    <div class="flex gap-2">
      <button onclick="setOrderType('dinein')" id="btnDine" class="flex-1 bg-zinc-800 p-3 rounded-lg border-2 border-transparent">Dine In</button>
      <button onclick="setOrderType('takeaway')" id="btnTake" class="flex-1 bg-zinc-800 p-3 rounded-lg border-2 border-transparent">Take Away</button>
    </div>

    <select id="categorySelect" onchange="showCategory(this.value)" class="w-full p-4 rounded-xl text-black font-bold">
      <option value="Starters">Starters</option>
      <option value="Main Course">Main Course</option>
      <option value="Breads">Breads</option>
      <option value="Rice">Rice</option>
      <option value="Dessert">Dessert</option>
      <option value="Drinks">Cold Drinks</option>
    </select>
  </div>

  <div id="menuContainer" class="max-w-4xl mx-auto"></div>

  <div class="fixed bottom-0 left-0 w-full bg-zinc-900 p-6 border-t border-white/10 z-50">
    <div class="max-w-md mx-auto">
      <div id="bufferContainer" class="hidden mb-4 bg-yellow-500/20 p-3 rounded-lg text-center text-yellow-500 font-bold border border-yellow-500">
        Buffer Active: <span id="timer">90</span>s
      </div>
      <button id="mainBtn" onclick="handleOrderAction()" class="w-full bg-yellow-500 text-black font-bold py-4 rounded-xl uppercase text-lg shadow-lg">Place Order</button>
    </div>
  </div>

<script>
let cart = []; let bufferActive = false; let timeLeft = 90; let timerInterval; let orderType = null;
const menu = {
  "Starters": [{name:"Paneer Tikka", price:220, img:"https://images.unsplash.com/photo-1567188040759-fb8a883dc6d8"}],
  "Main Course": [{name:"Paneer Bhurji", price:260, img:"https://images.unsplash.com/photo-1603894584214-434079873d9e"}],
  "Breads": [{name:"Butter Naan", price:40, img:"https://images.unsplash.com/photo-1601050638917-3d844766314d"}],
  "Rice": [{name:"Veg Biryani", price:250, img:"https://images.unsplash.com/photo-1563379091339-03b21bc4a4f8"}],
  "Dessert": [{name:"Gulab Jamun", price:80, img:"https://images.unsplash.com/photo-1589119908995-c6837fa14848"}],
  "Drinks": [{name:"Cold Drink", price:40, img:"https://images.unsplash.com/photo-1622483767028-3f66f32aef97"}]
};

function setOrderType(type) {
  orderType = type;
  document.getElementById('btnDine').style.borderColor = type === 'dinein' ? '#eab308' : 'transparent';
  document.getElementById('btnTake').style.borderColor = type === 'takeaway' ? '#eab308' : 'transparent';
}

function showCategory(cat) {
  const container = document.getElementById("menuContainer");
  container.innerHTML = `<div class="menu-category active">` + menu[cat].map(item => {
    const qty = (cart.find(i => i.name === item.name) || {qty:0}).qty;
    return `
      <div class="bg-white text-black rounded-xl overflow-hidden shadow-lg border border-gray-200">
        <img src="${item.img}" class="h-32 w-full object-cover">
        <div class="p-3">
          <p class="font-bold text-sm truncate">${item.name}</p>
          <div class="flex justify-between items-center mt-2">
            <span class="font-bold text-yellow-600">â‚¹${item.price}</span>
            <div class="flex gap-2 bg-gray-100 rounded-lg p-1">
              <button onclick="changeQty('${item.name}', -1)" class="px-2 font-bold">-</button>
              <span class="text-sm font-bold">${qty}</span>
              <button onclick="changeQty('${item.name}', 1)" class="px-2 font-bold text-yellow-600">+</button>
            </div>
          </div>
        </div>
      </div>`;
  }).join("") + `</div>`;
}

function changeQty(name, delta) {
  if(bufferActive) return;
  const idx = cart.findIndex(i => i.name === name);
  if(idx > -1) {
    cart[idx].qty += delta;
    if(cart[idx].qty <= 0) cart.splice(idx, 1);
  } else if(delta > 0) {
    let price = 0; for(let c in menu) { const f = menu[c].find(i=>i.name===name); if(f) price=f.price; }
    cart.push({name, price, qty: 1});
  }
  showCategory(document.getElementById("categorySelect").value);
}

function handleOrderAction() {
  if(bufferActive) {
    clearInterval(timerInterval);
    bufferActive = false;
    document.getElementById("bufferContainer").classList.add("hidden");
    document.getElementById("mainBtn").innerText = "Place Order";
    document.getElementById("menuContainer").classList.remove("locked");
  } else {
    if(!document.getElementById("custName").value || cart.length === 0 || !orderType) return alert("Complete details first");
    bufferActive = true; timeLeft = 90;
    document.getElementById("bufferContainer").classList.remove("hidden");
    document.getElementById("mainBtn").innerText = "EDIT ORDER";
    document.getElementById("menuContainer").classList.add("locked");
    timerInterval = setInterval(() => {
      timeLeft--; document.getElementById("timer").innerText = timeLeft;
      if(timeLeft <= 0) finalizeOrder();
    }, 1000);
  }
}

function finalizeOrder() {
  clearInterval(timerInterval);
  const payload = { 
    orderId: "EM-" + Date.now(), 
    name: document.getElementById("custName").value, 
    items: cart, 
    orderType: orderType,
    totalAmount: cart.reduce((s,i)=>s+(i.price*i.qty),0) 
  };
  fetch("/order", { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(payload) })
  .then(() => { alert("Order Sent to Kitchen!"); location.reload(); });
}
showCategory("Starters");
</script>
</body>
</html>