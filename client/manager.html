]<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><title>Manager | Emerald</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-3xl font-black mb-8 text-slate-800">ðŸ’¼ Manager Desk</h1>
  <div id="managerList" class="max-w-2xl mx-auto space-y-4"></div>

<script>
async function loadManagerData() {
  const res = await fetch("/manager-data");
  const data = await res.json();
  const container = document.getElementById("managerList");
  container.innerHTML = "";

  data.orders.filter(o => o.status !== "Completed").forEach(order => {
    const div = document.createElement("details");
    div.className = "bg-white p-4 rounded-xl shadow cursor-pointer transition-all";
    div.innerHTML = `
      <summary class="flex justify-between items-center font-bold text-slate-700">
        <span>${order.name} <span class="text-xs text-gray-400">#${order.orderId}</span></span>
        <span class="text-yellow-600">â‚¹${order.totalAmount}</span>
      </summary>
      <div class="mt-4 p-4 border-t border-gray-100 bg-gray-50 rounded-lg">
        <ul class="mb-4 space-y-1">${order.items.map(i => `<li class="text-sm flex justify-between"><span>${i.qty}x ${i.name}</span> <span>â‚¹${i.price * i.qty}</span></li>`).join("")}</ul>
        
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label class="text-[10px] font-bold uppercase text-gray-400">Discount (â‚¹)</label>
            <input id="rupee-${order.orderId}" type="number" value="0" oninput="calculateFinal('${order.orderId}', ${order.totalAmount})" class="w-full p-2 border rounded">
          </div>
          <div>
            <label class="text-[10px] font-bold uppercase text-gray-400">Discount (%)</label>
            <input id="pct-${order.orderId}" type="number" value="0" oninput="calculateFinal('${order.orderId}', ${order.totalAmount})" class="w-full p-2 border rounded">
          </div>
        </div>

        <div class="bg-white p-3 rounded-lg border mb-4 text-xs space-y-1">
          <div class="flex justify-between"><span>Subtotal</span> <span id="sub-${order.orderId}">â‚¹${order.totalAmount}</span></div>
          <div class="flex justify-between text-red-500"><span>Discount</span> <span id="disc-${order.orderId}">â‚¹0</span></div>
          <div class="flex justify-between"><span>CGST (2.5%)</span> <span id="cgst-${order.orderId}">â‚¹0</span></div>
          <div class="flex justify-between"><span>SGST (2.5%)</span> <span id="sgst-${order.orderId}">â‚¹0</span></div>
          <div class="flex justify-between font-bold text-lg border-t pt-1"><span>Total Bill</span> <span id="total-${order.orderId}">â‚¹${order.totalAmount}</span></div>
        </div>
        
        <button onclick="finalizeOrder('${order.orderId}')" class="w-full bg-black text-white py-3 rounded-xl font-bold uppercase">Generate & Print Bill</button>
      </div>`;
    container.appendChild(div);
  });
}

function calculateFinal(id, base) {
  const r = parseFloat(document.getElementById(`rupee-${id}`).value) || 0;
  const p = parseFloat(document.getElementById(`pct-${id}`).value) || 0;
  const disc = r + (base * (p/100));
  const afterDisc = base - disc;
  const cgst = afterDisc * 0.025; // 5% total GST as per Indian law
  const sgst = afterDisc * 0.025;
  const final = afterDisc + cgst + sgst;

  document.getElementById(`disc-${id}`).innerText = "â‚¹" + disc.toFixed(2);
  document.getElementById(`cgst-${id}`).innerText = "â‚¹" + cgst.toFixed(2);
  document.getElementById(`sgst-${id}`).innerText = "â‚¹" + sgst.toFixed(2);
  document.getElementById(`total-${id}`).innerText = "â‚¹" + final.toFixed(2);
}

async function finalizeOrder(id) {
  const finalTotal = document.getElementById(`total-${id}`).innerText.replace("â‚¹", "");
  await fetch("/finalize-bill", { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({orderId: id, finalTotal}) });
  window.print();
  loadManagerData();
}
setInterval(loadManagerData, 5000); loadManagerData();
</script>
</body>
</html>