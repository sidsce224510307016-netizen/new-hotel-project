<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"><title>Kitchen View | Emerald</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-zinc-900 text-white p-6">
  <h1 class="text-3xl font-bold mb-6 text-yellow-500">üçΩÔ∏è Kitchen Feed</h1>
  <div id="ordersContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>

<script>
async function loadOrders() {
  const res = await fetch("/orders");
  const orders = await res.json();
  const container = document.getElementById("ordersContainer");
  container.innerHTML = orders.length ? "" : "<p class='text-gray-400'>Waiting for orders...</p>";

  orders.filter(o => o.status === "Preparing").forEach(order => {
    const div = document.createElement("div");
    div.className = "bg-zinc-800 p-5 rounded-xl border-l-4 border-yellow-500 shadow-xl";
    div.innerHTML = `
      <div class="flex justify-between mb-4">
        <h2 class="text-xl font-bold">${order.name} <span class="text-xs text-gray-500">(${order.orderType})</span></h2>
        <button onclick="printKOT('${order.orderId}')" class="bg-zinc-700 px-3 py-1 rounded text-xs uppercase font-bold">Print KOT</button>
      </div>
      <ul class="space-y-2 mb-4">
        ${order.items.map(i => `<li class="flex justify-between"><span>${i.name}</span> <span class="font-bold">x${i.qty}</span></li>`).join("")}
      </ul>
      <button onclick="markPrepared('${order.orderId}')" class="w-full bg-green-600 py-2 rounded-lg font-bold uppercase">Mark Prepared</button>`;
    container.appendChild(div);
  });
}

function printKOT(id) {
  // Logic to print KOT (Items and Quantities only)
  window.print();
}

function markPrepared(id) {
  fetch("/mark-prepared", { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({orderId: id}) })
  .then(() => loadOrders());
}
setInterval(loadOrders, 5000); loadOrders();
</script>
</body>
</html>